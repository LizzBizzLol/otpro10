# otpro10
OTPRO labs

# ЛР №10: Time Series база данных Prometheus

## Описание лабораторной работы
Разработан экспортёр метрик на Python, он собирает данные об использовании процессора, оперативной памяти и дискового пространства. Экспортёр интегрирован с Prometheus для сбора метрик и выполнения запросов на их основе.

## Сбор метрик
Экспортёр собирает следующие метрики:
- **Использование процессоров**: процент загрузки каждого ядра CPU.
- **Использование памяти**:
  - Общее количество доступной оперативной памяти.
  - Объём используемой памяти.
- **Использование дисков**:
  - Общий объём дискового пространства.
  - Используемый объём дискового пространства.

Метрики доступны по корневому пути `/` в формате, совместимом с Prometheus.

## PromQL Запросы

### 1. Использование процессоров

**Использование процессоров (по всем ядрам):**

```promql
avg(cpu_usage_percentage) by (core)
```

Запрос покажет среднее использование процессоров по всем ядрам. 
Если вам нужно использование каждого ядра отдельно, запрос будет следующим:

```
cpu_usage_percentage
```

### 2. Оперативная память

**Память: всего и используется (совместный запрос):**

 Объединим два показателя — общий объем памяти и используемую память.

```
(memory_used_bytes / memory_total_bytes) * 100
```

Запрос покажет процент использования памяти, исходя из общего объема и используемой части.

### 3. Дисковое постранство

**Объем дисков: общий и используемый (по всем дискам):**

Аналогично с процессорами, запрос охватывает все диски. Здесь мы также использовуем агрегирующую функцию для получения общего объема и объема, который занят.

```
avg(disk_used_bytes) by (device) / avg(disk_total_bytes) by (device) * 100
```

Запрос покажет процент использования дисков на всех устройствах.

## Инструкция по запуску

### Установка и запуск экспортёра
1. Клонируйте репозиторий с экспортёром:
   ```bash
   git clone https://github.com/LizzBizzLol/otpro10.git
   cd otpro10
   ```
2. Установите зависимости Python:
   ```bash
   pip install -r requirements.txt
   ```
3. Запустите экспортёр:
   ```bash
   python exporter.py
   ```
   Экспортёр будет работать по адресу `http://127.0.0.1:8000` (если переменные окружения не переопределены).

### Настройка Prometheus
1. Скачайте и распакуйте Prometheus с [официального сайта](https://prometheus.io/download/).
2. В файле `prometheus.yml` добавьте следующую конфигурацию для сбора метрик с экспортёра:
   ```yaml
   scrape_configs:
     - job_name: "exporter"
       static_configs:
         - targets: ["127.0.0.1:8000"]
   ```
3. Запустите Prometheus:
   ```bash
   prometheus --config.file=prometheus.yml
   ```
   Интерфейс Prometheus будет доступен по адресу `http://127.0.0.1:9090`.

## Результаты работы
- Экспортёр собирает и предоставляет метрики.
- Prometheus интегрируется с экспортёром и выполняет запросы PromQL.
